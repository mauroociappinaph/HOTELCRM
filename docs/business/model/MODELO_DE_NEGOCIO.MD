CRM para Agencias de Viajes ‚Äì Especificaci√≥n T√©cnica y Funcional

1. Objetivo del Producto

Desarrollar un CRM SaaS para agencias de viajes con fuerte diferenciaci√≥n mediante IA, omnicanalidad, videollamadas asistidas, y automatizaci√≥n fiscal argentina, siguiendo principios de ingenier√≠a senior (SOLID, SRP, DRY, modularidad estricta).

2. Principios de Ingenier√≠a y Calidad

SOLID (√©nfasis en SRP)

DRY (helpers y servicios reutilizables)

Index Barrels (index.ts por carpeta)

M√°x. 300 l√≠neas por archivo

Arquitectura modular y escalable

Separaci√≥n clara de dominio, infraestructura y aplicaci√≥n

3. Stack Tecnol√≥gico

Backend

TypeScript

NestJS

Supabase (PostgreSQL + Auth + RLS)

pgvector para embeddings

Frontend

Next.js

TypeScript

shadcn/ui para componentes

i18n (Ingl√©s / Espa√±ol)

Auth & Seguridad

Login con Google (Supabase Auth)

Roles de usuario (Admin, Agent, Manager)

JWT + Refresh Tokens

4. DevOps y Est√°ndares

Husky (pre-commit y post-commit)

ESLint

Prettier

Jest (bloquea commits si fallan tests)

GitHub Actions (CI/CD)

Build

Tests

Deploy autom√°tico (Vercel / Railway)

5. Arquitectura Base de Datos (Supabase)

Tabla

Prop√≥sito

Relaciones

agencies

Configuraci√≥n general y fiscal (ARCA)

Ra√≠z

clients

Clientes enriquecidos con IA

N:1 agencies

itineraries

Viajes + Skyscanner

N:1 clients

bookings

Reservas

N:1 itineraries

invoices

Facturaci√≥n

1:1 bookings

tax_perceptions

Imp. PAIS y Ganancias

1:1 invoices

document_sections

Fragmentos vectoriales RAG

N:1 clients

RLS estricto: una agencia nunca accede a datos de otra.

6. Monetizaci√≥n

Stripe

Suscripci√≥n mensual SaaS

Roles y l√≠mites por plan

7. Sistema de Inteligencia Artificial

7.1 Estrategia de IA (APIs Gratuitas)

OpenRouter (LLMs gratuitos)

mistralai/devstral-2512:free ‚Üí agentes / l√≥gica

google/gemini-2.0-flash-exp:free ‚Üí documentos largos

Voyage AI (Embeddings)

voyage-4-nano

Hasta 200M tokens gratuitos

Otras APIs

Skyscanner ‚Üí precios y comparativas

Deepgram / AssemblyAI ‚Üí transcripci√≥n en tiempo real

7.2 Sistema RAG Avanzado (Context Mesh)

Agentic RAG

Ingesti√≥n (PDFs, chats, videollamadas)

Chunking sem√°ntico

Vectorizaci√≥n (Voyage AI)

Recuperaci√≥n h√≠brida:

SQL (Postgres)

Vectorial (pgvector)

Full Text Search (tsvector)

Generaci√≥n final con OpenRouter

Ejemplo de consulta:

"Clientes que viajaron a Bariloche en 2024, presupuesto > USD 5000 y prefieren hoteles boutique"

8. Comunicaci√≥n Omnicanal

Canales Integrados

WhatsApp

Gmail

LinkedIn

Slack

Telegram

Caracter√≠sticas

Timeline unificada

Memoria contextual compartida

Next-Best Actions sugeridas por IA

9. Videollamadas Asistidas por IA

Plataforma

Daily.co (Global Mesh Network)

Funcionalidades

Videollamada + Chat

Screen Sharing

Grabaci√≥n selectiva

Captura de pantalla

An√°lisis de sentimiento en vivo

Frontend

daily-react o useMeeting

Backend

Procesamiento de video

An√°lisis emocional

Auditor√≠a de calidad

10. Funcionalidades Diferenciadoras

Automatizaci√≥n fiscal argentina (Imp. PAIS + Ganancias)

Auto-enriquecimiento de leads desde LinkedIn

OCR de pasaportes

Lead Scoring por sentimiento

FAQ din√°mica autoaprendida

Resumen autom√°tico de videollamadas a Notion

Clonaci√≥n de tono de voz para emails

Detecci√≥n de fraude

Mapa de calor de destinos

B√∫squeda sem√°ntica hist√≥rica

Slash commands en Slack

Notificaciones interactivas en Telegram

Google Calendar Sync

Uber / Cabify

Airbnb Bridge

Tripadvisor Sync

Auto check-in a√©reo

11. Gamificaci√≥n y Ventas

Ranking mensual

Badges por destinos nuevos

Metas con premios

IA Coach para llamadas

12. Soporte y Post‚ÄëVenta

NPS autom√°tico

Bot de emergencia 24/7 (WhatsApp)

Recordatorio ‚ÄúWelcome Home‚Äù

Generador de itinerarios PDF

13. Internacionalizaci√≥n

Idiomas: Espa√±ol / Ingl√©s

Librer√≠as i18n

14. Arquitectura de Microservicios (Decisi√≥n de Grandes Ligas)

Implementar el sistema como microservicios es una decisi√≥n estrat√©gica de alto nivel. Para un CRM que integra videollamadas, IA, notificaciones y finanzas, esta arquitectura garantiza resiliencia: si el sistema de video falla, el CRM de ventas, chat y facturaci√≥n contin√∫a funcionando sin interrupciones.

Esta arquitectura respeta estrictamente SOLID, SRP, DRY y la regla de archivos < 300 l√≠neas.

15. Mapa de Microservicios (Estructura de Poder)

El sistema se divide en 6 microservicios independientes, comunicados entre s√≠:

1. Auth & Users Service

Login con Gmail (Supabase Auth)

Gesti√≥n de roles (Admin, Agent, Traveler)

Perfiles de usuario

2. IA & RAG Service (The Brain)

Integraci√≥n con OpenRouter (LLMs)

Generaci√≥n de embeddings (Voyage AI)

Memoria vectorial (pgvector)

Implementaci√≥n del Context Mesh

√önico servicio autorizado a hablar con LLMs

3. Booking & Inventory Service

Itinerarios y viajes

Integraci√≥n con Skyscanner

Gesti√≥n de reservas

4. Communication & Video Service

Videollamadas (Daily.co)

Screen Sharing

An√°lisis de sentimiento en vivo

Bots de Slack y Telegram

5. Finance & Tax Service

C√°lculo de Impuesto PAIS y percepciones

Facturaci√≥n electr√≥nica

Monetizaci√≥n SaaS (Stripe)

6. Notification & Worker Service

Emails y alertas

Colas de trabajo

Procesos pesados asincr√≥nicos

16. Plan Maestro de Ejecuci√≥n con Microservicios (Paso a Paso)

Paso 1 ‚Äì Monorepo y Setup Global

Uso de Monorepo (Turborepo o NestJS multi-app)

Compartir common/helpers y DTOs

Husky:

pre-commit ‚Üí ESLint + Prettier

post-commit ‚Üí confirmaci√≥n de commit

CI/CD con GitHub Actions

Tests Jest por microservicio

Paso 2 ‚Äì Base de Datos Distribuida (Supabase)

Una instancia de Supabase

Esquemas separados por microservicio

SRP aplicado a nivel de datos

Paso 3 ‚Äì Comunicaci√≥n Inter-servicios

Redis / RabbitMQ ‚Üí tareas pesadas (PDFs, IA, video)

HTTP / gRPC ‚Üí consultas r√°pidas

Paso 4 ‚Äì Context Mesh (RAG Centralizado)

Servicio de IA expone endpoints de contexto

Otros servicios consultan preferencias y memoria

Ejemplo:

El servicio de ventas pregunta: "¬øQu√© prefiere este cliente?"
El servicio de IA consulta SQL + vectores y responde.

17. Plan Maestro de Ejecuci√≥n (Paso a Paso)

15. Condici√≥n Final

üëâ Antes de escribir una sola l√≠nea de c√≥digo, este plan debe validarse paso a paso.
